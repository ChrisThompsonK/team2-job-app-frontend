services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: team2-job-app-frontend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      # Allow insecure cookies for Docker/local development (disable in production HTTPS)
      - SECURE_COOKIES=false
      # Backend API URLs
      # Options:
      # 1. Backend in separate Docker container: http://backend:8000
      # 2. Backend on host machine: http://host.docker.internal:8000
      # 3. Backend on remote server: http://your-server.com:8000
      - API_BASE_URL=${API_BASE_URL:-http://host.docker.internal:8000}
      - AUTH_API_BASE_URL=${AUTH_API_BASE_URL:-http://host.docker.internal:8000/api/auth}
      # Session configuration
      - SESSION_SECRET=${SESSION_SECRET:-change-this-in-production-min-32-chars}
      - PORT=3000
    # Uncomment if backend is also defined in this docker-compose file
    # depends_on:
    #   backend:
    #     condition: service_healthy
    # Connect to the backend network (optional - only needed if backend is in Docker)
    networks:
      - app-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000/', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3

  # Backend service reference - uncomment if backend is not already running
  # backend:
  #   build:
  #     context: ../team2-job-app-backend
  #     dockerfile: Dockerfile
  #   container_name: team2-job-app-backend
  #   ports:
  #     - "8000:8000"
  #   environment:
  #     - NODE_ENV=production
  #     - APP_NAME=team2-job-app-backend
  #     - APP_VERSION=1.0.0
  #     - PORT=8000
  #     - HOST=0.0.0.0
  #     - DATABASE_URL=/app/data/database.sqlite
  #     - SESSION_SECRET=${SESSION_SECRET:-change-this-in-production-min-32-chars}
  #     - SESSION_NAME=job_app_session
  #     - SESSION_MAX_AGE=604800000
  #   volumes:
  #     - db-data:/app/data
  #   networks:
  #     - app-network
  #   restart: unless-stopped
  #   healthcheck:
  #     test: ["CMD", "node", "-e", "require('http').get('http://localhost:8000/', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
  #     interval: 30s
  #     timeout: 3s
  #     start_period: 5s
  #     retries: 3

networks:
  app-network:
    driver: bridge

# volumes:
#   db-data:
#     driver: local
